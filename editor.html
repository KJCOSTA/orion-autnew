<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>ORION â€” Editor do CORE</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-900 text-slate-100 min-h-screen p-6">

<h1 class="text-3xl font-bold mb-4">Editor do CORE â€” ORION</h1>

<textarea id="editor"
  class="w-full h-[60vh] bg-slate-800 text-sm p-4 rounded mb-4 font-mono"></textarea>

<button onclick="saveCore()"
  class="bg-emerald-600 hover:bg-emerald-700 px-6 py-2 rounded font-semibold">
  ðŸ’¾ Salvar CORE
</button>

<pre id="status" class="mt-4 text-sm text-slate-400"></pre>

<script>
const RAW_CORE =
  "https://raw.githubusercontent.com/KJCOSTA/orion-data/main/data/core_oraculum.json";

async function loadCore() {
  const res = await fetch(RAW_CORE);
  const json = await res.json();
  document.getElementById("editor").value =
    JSON.stringify(json, null, 2);
}

async function saveCore() {
  const token = prompt("Cole seu GitHub Token (repo):");
  if (!token) return;

  const content = document.getElementById("editor").value;
  const core = JSON.parse(content);

  const apiBase =
    "https://api.github.com/repos/KJCOSTA/orion-data/contents";

  const headers = {
    "Authorization": "Bearer " + token,
    "Accept": "application/vnd.github+json"
  };

  // 1ï¸âƒ£ Atualiza core_oraculum.json
  const shaRes = await fetch(
    apiBase + "/data/core_oraculum.json",
    { headers }
  );
  const shaJson = await shaRes.json();

  await fetch(apiBase + "/data/core_oraculum.json", {
    method: "PUT",
    headers,
    body: JSON.stringify({
      message: "ORION: atualiza CORE via editor",
      content: btoa(unescape(encodeURIComponent(JSON.stringify(core, null, 2)))),
      sha: shaJson.sha
    })
  });

  // 2ï¸âƒ£ Adiciona log
  const logRes = await fetch(
    apiBase + "/logs/orion_logs.json",
    { headers }
  );
  const logJson = await logRes.json();
  const logs = JSON.parse(atob(logJson.content));

  logs.push({
    timestamp: new Date().toISOString(),
    tipo: "editor",
    mensagem: "CORE atualizado via editor visual",
    fase: core.fases.find(f => f.status === "ativa")?.nome || "-"
  });

  await fetch(apiBase + "/logs/orion_logs.json", {
    method: "PUT",
    headers,
    body: JSON.stringify({
      message: "ORION: log de atualizaÃ§Ã£o do CORE",
      content: btoa(unescape(encodeURIComponent(JSON.stringify(logs, null, 2)))),
      sha: logJson.sha
    })
  });

  document.getElementById("status").textContent =
    "âœ… CORE salvo com sucesso no orion-data";
}

loadCore();
</script>

</body>
</html>
